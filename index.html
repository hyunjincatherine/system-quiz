<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KRAFTON Onboarding Â· Matching Quiz</title>
  <style>
    :root{
      --bgA:#F7FBFF;
      --bgB:#EEF6FF;
      --card:#FFFFFF;
      --card2:#F7FAFF;
      --stroke: rgba(15, 23, 42, .10);
      --text:#0F172A;
      --muted:#475569;
      --muted2:#64748B;

      --brand:#0EA5E9;   /* sky-500 */
      --brand2:#22C55E;  /* green-500 */
      --good:#16A34A;    /* green-600 */
      --bad:#E11D48;     /* rose-600 */

      --shadow: 0 18px 50px rgba(2, 6, 23, .08);
      --shadow2: 0 10px 26px rgba(2, 6, 23, .10);

      --r16: 16px;
      --r20: 20px;
      --r24: 24px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto,
                   "Noto Sans KR", "Apple SD Gothic Neo", "Malgun Gothic", sans-serif;
      color: var(--text);
      background:
        radial-gradient(900px 520px at 20% 0%, rgba(14,165,233,.18), transparent 60%),
        radial-gradient(900px 520px at 95% 25%, rgba(34,197,94,.14), transparent 60%),
        radial-gradient(900px 520px at 10% 95%, rgba(217,119,6,.12), transparent 60%),
        linear-gradient(180deg, var(--bgA), var(--bgB));
      overflow-x:hidden;
    }

    /* âœ… í’€í­ + ìƒë‹¨ ì—¬ë°± ë„‰ë„‰íˆ */
    .wrap{
      width: 100%;
      max-width: none;
      margin: 0;
      padding: 84px 0 36px; /* ìƒë‹¨ ì—¬ë°± â†‘, ì¢Œìš°ëŠ” 0 */
    }

    /* âœ… ì¢Œìš° ì—¬ë°±ì€ ìµœì†Œ(ì»¨í…ì¸ ë§Œ ì‚´ì§ ìˆ¨ ì‰¬ê²Œ) */
    .content{
      margin: 0 18px;
    }
    @media (max-width: 480px){
      .content{ margin: 0 12px; }
    }

    /* Header */
    .top{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 16px;
      margin-bottom: 14px;
    }
    .brandRow{
      display:flex;
      align-items:center;
      gap: 12px;
    }
    .logo{
      width: 44px; height: 44px;
      border-radius: 16px;
      background:
        radial-gradient(12px 12px at 30% 30%, rgba(255,255,255,.90), transparent 60%),
        linear-gradient(135deg, rgba(14,165,233,.70), rgba(34,197,94,.45));
      border:1px solid rgba(255,255,255,.80);
      box-shadow: var(--shadow2);
      display:grid;
      place-items:center;
      user-select:none;
      flex: 0 0 auto;
    }
    .logo span{
      font-weight: 900;
      letter-spacing:-.6px;
      color: rgba(255,255,255,.95);
      font-size: 14px;
    }
    h1{
      margin:0;
      font-size: 18px;
      letter-spacing:-0.3px;
      line-height: 1.2;
    }
    .sub{
      margin: 6px 0 0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.6;
      max-width: 780px;
    }

    .actions{
      display:flex;
      gap: 8px;
      flex-wrap:wrap;
      justify-content:flex-end;
      align-items:center;
    }

    .btn{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.75);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      font-weight: 800;
      cursor:pointer;
      transition: transform .06s ease, background .2s ease, border-color .2s ease, box-shadow .2s ease;
      user-select:none;
      box-shadow: 0 6px 14px rgba(2,6,23,.06);
    }
    .btn:hover{
      background: rgba(255,255,255, .92);
      border-color: rgba(15,23,42,.18);
      box-shadow: 0 10px 22px rgba(2,6,23,.10);
    }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{
      background: rgba(14,165,233,.16);
      border-color: rgba(14,165,233,.28);
      box-shadow: 0 8px 16px rgba(14,165,233,.12);
    }
    .btn.primary:hover{
      background: rgba(14,165,233,.22);
      border-color: rgba(14,165,233,.38);
    }
    .btn.ghost{
      background: rgba(255,255,255,.55);
    }
    .btn.danger{
      background: rgba(225,29,72,.10);
      border-color: rgba(225,29,72,.22);
      box-shadow: 0 8px 16px rgba(225,29,72,.10);
    }
    .btn.danger:hover{
      background: rgba(225,29,72,.14);
      border-color: rgba(225,29,72,.32);
    }
    .btn:disabled{
      opacity:.55;
      cursor:not-allowed;
      transform:none;
      box-shadow:none;
    }

    /* Summary bar */
    .summary{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 12px;
      margin: 14px 0 14px;
    }
    @media (max-width: 920px){
      .top{ flex-direction:column; align-items:stretch; }
      .actions{ justify-content:flex-start; }
      .summary{ grid-template-columns: 1fr; }
    }

    .panel{
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.80), rgba(255,255,255,.60));
      border-radius: var(--r24);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .panelInner{
      padding: 14px 14px 12px;
    }
    .metaRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      margin-bottom: 10px;
    }
    .chips{
      display:flex;
      gap: 8px;
      flex-wrap:wrap;
      align-items:center;
    }
    .chip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 7px 10px;
      border-radius: 999px;
      border:1px solid var(--stroke);
      background: rgba(248,250,252,.9);
      color: var(--muted);
      font-size: 12px;
      font-weight: 850;
      user-select:none;
    }
    .chip b{ color: var(--text); }

    .progressWrap{
      height: 10px;
      border-radius: 999px;
      background: rgba(2,6,23,.06);
      border: 1px solid rgba(15,23,42,.10);
      overflow:hidden;
    }
    .progressBar{
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, rgba(14,165,233,.95), rgba(34,197,94,.85));
      border-right: 1px solid rgba(255,255,255,.70);
      transition: width .25s ease;
    }

    .help{
      color: var(--muted);
      font-size: 13px;
      line-height: 1.65;
      padding: 14px 16px;
      border-left:1px solid var(--stroke);
      background: rgba(248,250,252,.75);
      height: 100%;
    }

    /* Board */
    .board{
      position:relative;
      border:1px solid var(--stroke);
      border-radius: var(--r24);
      background: linear-gradient(180deg, rgba(255,255,255,.78), rgba(255,255,255,.56));
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    /* âœ… ê°€ìš´ë° ê°„ê²© ë„“íˆê¸°(ì„  ëœ ê²¹ì¹˜ê²Œ) */
    .grid{
      display:grid;
      grid-template-columns: 1fr 150px 1fr; /* ê°€ìš´ë° ìŠ¤í˜ì´ì„œ */
      gap: 12px;
      padding: 16px;
    }
    @media (max-width: 920px){
      .grid{ grid-template-columns: 1fr; }
      .spacer{ display:none; }
    }

    .colHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 12px 12px;
      border:1px solid var(--stroke);
      border-radius: var(--r20);
      background: rgba(248,250,252,.9);
      margin-bottom: 10px;
    }
    .colHeader .title{
      font-weight: 950;
      letter-spacing: -.2px;
      font-size: 13px;
    }
    .colHeader .desc{
      font-size: 12px;
      color: var(--muted2);
      font-weight: 750;
    }

    .list{
      display:flex;
      flex-direction:column;
      gap: 10px;
    }

    .item{
      position:relative;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      padding: 12px 12px;
      min-height: 56px;
      border-radius: var(--r20);
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.78);
      transition: transform .06s ease, background .18s ease, border-color .18s ease, box-shadow .18s ease;
      cursor:pointer;
    }
    .item:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,.92);
      border-color: rgba(15,23,42,.18);
      box-shadow: 0 10px 22px rgba(2,6,23,.10);
    }
    .item.selected{
      border-color: rgba(14,165,233,.55);
      box-shadow: 0 0 0 4px rgba(14,165,233,.14) inset, 0 10px 24px rgba(2,6,23,.10);
      background: rgba(14,165,233,.08);
    }
    .item.locked{
      opacity:.95;
    }

    .textBlock{
      display:flex;
      flex-direction:column;
      gap: 4px;
      min-width: 0;
    }
    .small{
      font-size: 12px;
      color: var(--muted2);
      font-weight: 900;
      letter-spacing:.2px;
    }
    .main{
      font-size: 14px;
      line-height: 1.35;
      font-weight: 850;
      color: rgba(15,23,42,.92);
      word-break: keep-all;
      overflow-wrap:anywhere;
    }

    .dot{
      width: 14px; height: 14px;
      border-radius: 999px;
      border: 2px solid rgba(15,23,42,.45);
      background: rgba(255,255,255,.90);
      flex: 0 0 auto;
      position:relative;
      box-shadow: 0 8px 18px rgba(2,6,23,.10);
    }

    .badge{
      display:none;
      margin-left: 10px;
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 950;
      border:1px solid var(--stroke);
      background: rgba(248,250,252,.9);
      color: var(--muted);
      white-space:nowrap;
    }
    .badge.good{
      border-color: rgba(22,163,74,.28);
      background: rgba(22,163,74,.10);
      color: rgba(20,83,45,.98);
    }
    .badge.bad{
      border-color: rgba(225,29,72,.28);
      background: rgba(225,29,72,.10);
      color: rgba(136,19,55,.98);
    }

    /* Bottom status card */
    .statusCard{
      margin-top: 14px;
      border:1px solid var(--stroke);
      border-radius: var(--r24);
      background: rgba(255,255,255,.78);
      box-shadow: var(--shadow2);
      padding: 14px 16px;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.65;
    }

    /* Toast */
    .toast{
      position: fixed;
      top: 16px;
      left: 50%;
      transform: translateX(-50%) translateY(-20px);
      opacity: 0;
      pointer-events:none;
      background: rgba(255,255,255,.90);
      border:1px solid rgba(15,23,42,.12);
      color: rgba(15,23,42,.92);
      padding: 10px 12px;
      border-radius: 16px;
      box-shadow: 0 18px 60px rgba(2,6,23,.12);
      backdrop-filter: blur(10px);
      transition: opacity .18s ease, transform .18s ease;
      max-width: min(760px, calc(100vw - 24px));
      font-size: 13px;
      line-height: 1.45;
      z-index: 50;
    }
    .toast.show{
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
    .toast .t{
      font-weight: 950;
      color: rgba(15,23,42,.96);
    }
    .toast.good{ border-color: rgba(22,163,74,.26); }
    .toast.bad { border-color: rgba(225,29,72,.26); }
    .toast.info{ border-color: rgba(14,165,233,.26); }

    /* SVG lines */
    svg#lines{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      pointer-events:none;
    }
    .line{
      fill:none;
      stroke-linecap: round;
      stroke-width: 3.6;
      filter: drop-shadow(0 10px 18px rgba(2,6,23,.08));
    }
    .line.neutral{ stroke: rgba(14,165,233,.70); }
    .line.good{ stroke: rgba(22,163,74,.78); }
    .line.bad{ stroke: rgba(225,29,72,.78); }

    /* Submit block inside status */
    .submitRow{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      align-items:center;
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px dashed rgba(15,23,42,.14);
    }
    .submitNote{
      color: var(--muted2);
      font-size: 12px;
      font-weight: 700;
      line-height: 1.5;
    }
    a.linkBtn{
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:8px;
    }

    /* Confetti canvas */
    canvas#confetti{
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      pointer-events:none;
      z-index: 60;
    }

    /* Accessibility focus */
    .item:focus-visible, .btn:focus-visible, a.linkBtn:focus-visible{
      outline: 3px solid rgba(14,165,233,.35);
      outline-offset: 2px;
      border-radius: 14px;
    }
  </style>
</head>

<body>
  <canvas id="confetti"></canvas>
  <div class="toast" id="toast"></div>

  <div class="wrap">
    <div class="content">

      <div class="top">
        <div>
          <div class="brandRow">
            <div class="logo" aria-hidden="true"><span>ONB</span></div>
            <div>
              <h1>ì˜¨ë³´ë”© ë¯¸ì…˜ Â· ì‹œìŠ¤í…œ ë§¤ì¹­ í€´ì¦ˆ</h1>
              <p class="sub">
                ì™¼ìª½ ì§ˆë¬¸ì„ ì„ íƒí•œ ë’¤ ì˜¤ë¥¸ìª½ ë‹µë³€ì„ ì„ íƒí•˜ë©´ ì—°ê²°ë©ë‹ˆë‹¤.
                <b>7ê°œ ëª¨ë‘ ì—°ê²°</b>í•˜ë©´ ì±„ì  ë²„íŠ¼ì´ í™œì„±í™”ë¼ìš”.
              </p>
            </div>
          </div>
        </div>

        <div class="actions">
          <button class="btn primary" id="btnGrade" disabled>ì±„ì </button>
          <button class="btn ghost" id="btnShowAnswers" disabled>ì •ë‹µ ë³´ê¸°</button>
          <button class="btn danger" id="btnReset">ë¦¬ì…‹</button>
        </div>
      </div>

      <div class="summary">
        <div class="panel">
          <div class="panelInner">
            <div class="metaRow">
              <div class="chips">
                <span class="chip">ì§„í–‰ <b id="progress">0/7</b></span>
                <span class="chip">ì ìˆ˜ <b id="score">-</b></span>
                <span class="chip">ì¤‘ë³µ ì—°ê²° <b>ë¶ˆê°€</b></span>
              </div>
              <div class="chip">ì„ íƒ í•´ì œ <b>ESC</b></div>
            </div>

            <div class="progressWrap" aria-label="progress">
              <div class="progressBar" id="progressBar"></div>
            </div>
          </div>
        </div>

        <div class="panel">
          <div class="help">
            <b style="color:rgba(15,23,42,.92)">Tip</b><br/>
            â€¢ ì´ë¯¸ ì—°ê²°ëœ ì§ˆë¬¸ì„ ë‹¤ì‹œ í´ë¦­í•˜ë©´ <b>ì—°ê²° í•´ì œ</b>ë©ë‹ˆë‹¤.<br/>
            â€¢ ëª¨ë‘ ì—°ê²° í›„ <b>ì±„ì </b>í•˜ë©´ ì„  ìƒ‰ìœ¼ë¡œ ì •ì˜¤ë‹µì´ í‘œì‹œë©ë‹ˆë‹¤.<br/>
            â€¢ <b>ì±„ì  í›„</b> ì™„ë£Œ ë©”ì¼ì„ ë³´ë‚¼ ìˆ˜ ìˆì–´ìš”. (ì ìˆ˜/ì†Œìš”ì‹œê°„ ìë™ í¬í•¨)
          </div>
        </div>
      </div>

      <div class="board" id="board">
        <svg id="lines"></svg>

        <div class="grid">
          <section>
            <div class="colHeader">
              <div class="title">ì§ˆë¬¸</div>
              <div class="desc">í´ë¦­í•´ì„œ ì„ íƒ</div>
            </div>
            <div class="list" id="leftList"></div>
          </section>

          <section class="spacer" aria-hidden="true"></section>

          <section>
            <div class="colHeader">
              <div class="title">ë‹µë³€</div>
              <div class="desc">í´ë¦­í•´ì„œ ì—°ê²°</div>
            </div>
            <div class="list" id="rightList"></div>
          </section>
        </div>
      </div>

      <div class="statusCard" id="status">
        ì•„ì§ ì—°ê²°ì´ ì—†ìŠµë‹ˆë‹¤. ì™¼ìª½ ì§ˆë¬¸ì„ ì„ íƒí•´ë³´ì„¸ìš”.
      </div>

    </div>
  </div>

<script>
(() => {
  const OWNER_EMAIL = "hyunjin@krafton.com";

  const questions = [
    { id: "q1", text: "ì¼ë°˜í’ˆì˜(ê²°ì¬) ìŠ¹ì¸ì„ ìš”ì²­í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ì‹œìŠ¤í…œì€?" },
    { id: "q2", text: "ë²•ì¸ì¹´ë“œ ì‚¬ìš© ë‚´ì—­ì„ ì •ì‚°í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ì‹œìŠ¤í…œì€?" },
    { id: "q3", text: "ë¬¸ì„œ ì‘ì„±, ì¼ì • ê´€ë¦¬, ì‚¬ë‚´ ì •ë³´ ê²€ìƒ‰ì„ ë„ì™€ì£¼ëŠ” í¬ë˜í”„í†¤ë§Œì˜ ì±—ë´‡ì˜ ì´ë¦„ì€?" },
    { id: "q4", text: "ì‚¬ë‚´ ì£¼ìš” ê°€ì´ë“œì™€ ì—…ë¬´ ìœ„í‚¤ê°€ ì•„ì¹´ì´ë¹™ëœ ê³³ì€?" },
    { id: "q5", text: "í”„ë¡œì íŠ¸/ì´ìŠˆ íŠ¸ë˜í‚¹ì„ ë„ì™€ì£¼ëŠ” ì—…ë¬´ ê´€ë¦¬ ì‹œìŠ¤í…œì€?" },
    { id: "q6", text: "ì‹¤ì‹œê°„ ì†Œí†µê³¼ í˜‘ì—…ì„ ìœ„í•œ ë©”ì‹ ì € ì‹œìŠ¤í…œì€?" },
    { id: "q7", text: "ì˜¨ë¼ì¸ ë¯¸íŒ… ë° í™”ìƒíšŒì˜ ì‹œ ì‚¬ìš©í•˜ëŠ” ì‹œìŠ¤í…œì€?" },
  ];

  const answers = [
    { id: "a1", text: "Jira" },
    { id: "a2", text: "Confluence(Wiki)" },
    { id: "a3", text: "KRIS" },
    { id: "a4", text: "Concur" },
    { id: "a5", text: "Zoom" },
    { id: "a6", text: "Slack" },
    { id: "a7", text: "Kissflow" },
  ];

  const correct = {
    q1: "a7",
    q2: "a4",
    q3: "a3",
    q4: "a2",
    q5: "a1",
    q6: "a6",
    q7: "a5",
  };

  const state = {
    selectedQ: null,
    pairByQ: {},
    pairByA: {},
    graded: false,
    lastScore: null,
    startedAt: Date.now(),
  };

  const leftList = document.getElementById("leftList");
  const rightList = document.getElementById("rightList");
  const svg = document.getElementById("lines");
  const board = document.getElementById("board");
  const status = document.getElementById("status");
  const progressEl = document.getElementById("progress");
  const scoreEl = document.getElementById("score");
  const progressBar = document.getElementById("progressBar");

  const btnGrade = document.getElementById("btnGrade");
  const btnReset = document.getElementById("btnReset");
  const btnShowAnswers = document.getElementById("btnShowAnswers");
  const toast = document.getElementById("toast");
  const confettiCanvas = document.getElementById("confetti");

  const shuffle = (arr) => arr
    .map(v => ({ v, r: Math.random() }))
    .sort((a,b) => a.r - b.r)
    .map(x => x.v);

  function escapeHtml(str){
    return String(str)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  function setStatus(msg){
    status.innerHTML = msg;
  }

  let toastTimer = null;
  function showToast(kind, title, message){
    toast.className = `toast show ${kind}`;
    toast.innerHTML = `<span class="t">${escapeHtml(title)}</span> Â· ${escapeHtml(message)}`;
    clearTimeout(toastTimer);
    toastTimer = setTimeout(() => {
      toast.className = "toast";
      toast.innerHTML = "";
    }, 1800);
  }

  function updateProgress(){
    const count = Object.keys(state.pairByQ).length;
    progressEl.textContent = `${count}/${questions.length}`;
    progressBar.style.width = `${Math.round((count / questions.length) * 100)}%`;

    btnGrade.disabled = (count !== questions.length);
    btnShowAnswers.disabled = !state.graded;
  }

  function clearSelections(){
    state.selectedQ = null;
    document.querySelectorAll(".item.selected").forEach(el => el.classList.remove("selected"));
  }

  function getDotCenter(dotEl){
    const bRect = board.getBoundingClientRect();
    const dRect = dotEl.getBoundingClientRect();
    const x = (dRect.left - bRect.left) + dRect.width/2;
    const y = (dRect.top  - bRect.top ) + dRect.height/2;
    return { x, y };
  }

  function drawLines(){
    svg.innerHTML = "";
    const bRect = board.getBoundingClientRect();
    svg.setAttribute("viewBox", `0 0 ${bRect.width} ${bRect.height}`);

    Object.entries(state.pairByQ).forEach(([qId, aId]) => {
      const qDot = document.querySelector(`.dot[data-dot-for="${qId}"]`);
      const aDot = document.querySelector(`.dot[data-dot-for="${aId}"]`);
      if(!qDot || !aDot) return;

      const p1 = getDotCenter(qDot);
      const p2 = getDotCenter(aDot);

      const dx = Math.abs(p2.x - p1.x);
      const c1x = p1.x + Math.min(280, dx * 0.45);
      const c2x = p2.x - Math.min(280, dx * 0.45);

      const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
      path.setAttribute("d", `M ${p1.x} ${p1.y} C ${c1x} ${p1.y}, ${c2x} ${p2.y}, ${p2.x} ${p2.y}`);

      let cls = "line neutral";
      if(state.graded){
        cls = (correct[qId] === aId) ? "line good" : "line bad";
      }
      path.setAttribute("class", cls);
      svg.appendChild(path);
    });
  }

  function renderLockStates(){
    document.querySelectorAll("[data-qid]").forEach(el => {
      const qId = el.dataset.qid;
      el.classList.toggle("locked", !!state.pairByQ[qId]);
    });
    document.querySelectorAll("[data-aid]").forEach(el => {
      const aId = el.dataset.aid;
      el.classList.toggle("locked", !!state.pairByA[aId]);
    });
  }

  function rerenderAll(){
    updateProgress();
    renderLockStates();
    drawLines();
  }

  function labelOfQ(qId){
    const i = questions.findIndex(x => x.id === qId);
    return `Q${i+1}`;
  }
  function labelOfA(aId){
    const a = answers.find(x => x.id === aId);
    return a ? a.text : aId;
  }

  function fmtDuration(ms){
    const s = Math.max(0, Math.floor(ms/1000));
    const mm = String(Math.floor(s/60)).padStart(2,"0");
    const ss = String(s%60).padStart(2,"0");
    return `${mm}:${ss}`;
  }

  function buildMailto(score){
    const total = questions.length;
    const duration = fmtDuration(Date.now() - state.startedAt);
    const when = new Date().toLocaleString();

    const subject = `[Onboarding Mission] ì‹œìŠ¤í…œ ë§¤ì¹­ í€´ì¦ˆ ì™„ë£Œ (${score}/${total})`;
    const body =
`ì•ˆë…•í•˜ì„¸ìš”. ì˜¨ë³´ë”© ë¯¸ì…˜(ì‹œìŠ¤í…œ ë§¤ì¹­ í€´ì¦ˆ) ê²°ê³¼ë¥¼ ê³µìœ ë“œë¦½ë‹ˆë‹¤.

- ì´ë¦„:
- ì†Œì†:
- ì ìˆ˜: ${score}/${total}
- ì†Œìš” ì‹œê°„: ${duration}
- ì™„ë£Œ ì‹œê°: ${when}

ê°ì‚¬í•©ë‹ˆë‹¤.`;

    return `mailto:${encodeURIComponent(OWNER_EMAIL)}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
  }

  function renderSubmitBlock(score){
    const total = questions.length;
    const mailto = buildMailto(score);

    return `
      <div class="submitRow">
        <a class="btn primary linkBtn" id="sendMailLink" href="${mailto}">
          ë‹´ë‹¹ìì—ê²Œ ì™„ë£Œ ë©”ì¼ ë³´ë‚´ê¸°
        </a>
        <div class="submitNote">
          ë°›ëŠ” ì‚¬ëŒ: <b>${escapeHtml(OWNER_EMAIL)}</b><br/>
          í˜„ì¬ ì ìˆ˜: <b>${score}/${total}</b><br/>
          ì ìˆ˜ì™€ ì†Œìš”ì‹œê°„ì´ ìë™ìœ¼ë¡œ í¬í•¨ë©ë‹ˆë‹¤.<br/>
          ì›í•˜ì‹œë©´ ë‹¤ì‹œ í’€ì–´ë³¸ ë’¤ ì œì¶œí•´ë„ ê´œì°®ì•„ìš” ğŸ™‚
        </div>
      </div>
    `;
  }

  // Confetti
  let confettiRunning = false;
  function launchConfetti(durationMs = 2200){
    if(confettiRunning) return;
    confettiRunning = true;

    const ctx = confettiCanvas.getContext("2d");
    const DPR = Math.max(1, Math.floor(window.devicePixelRatio || 1));

    function resize(){
      confettiCanvas.width = Math.floor(window.innerWidth * DPR);
      confettiCanvas.height = Math.floor(window.innerHeight * DPR);
      confettiCanvas.style.width = window.innerWidth + "px";
      confettiCanvas.style.height = window.innerHeight + "px";
      ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
    }
    resize();

    const colors = ["#0EA5E9","#22C55E","#F59E0B","#A78BFA","#FB7185","#34D399"];
    const pieces = [];
    const count = 160;

    for(let i=0;i<count;i++){
      pieces.push({
        x: Math.random() * window.innerWidth,
        y: -20 - Math.random() * window.innerHeight * 0.2,
        w: 6 + Math.random()*6,
        h: 8 + Math.random()*10,
        vx: (Math.random()-0.5) * 5,
        vy: 2 + Math.random()*5,
        rot: Math.random() * Math.PI,
        vr: (Math.random()-0.5) * 0.18,
        color: colors[Math.floor(Math.random()*colors.length)],
        alpha: 0.9
      });
    }

    const t0 = performance.now();
    function tick(t){
      const elapsed = t - t0;
      ctx.clearRect(0,0,window.innerWidth,window.innerHeight);

      for(const p of pieces){
        p.x += p.vx;
        p.y += p.vy;
        p.vy += 0.03;
        p.rot += p.vr;
        p.alpha = Math.max(0, 0.95 - elapsed/(durationMs*1.2));

        ctx.save();
        ctx.globalAlpha = p.alpha;
        ctx.translate(p.x, p.y);
        ctx.rotate(p.rot);
        ctx.fillStyle = p.color;
        ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
        ctx.restore();
      }

      if(elapsed < durationMs){
        requestAnimationFrame(tick);
      } else {
        ctx.clearRect(0,0,window.innerWidth,window.innerHeight);
        confettiRunning = false;
      }
    }

    window.addEventListener("resize", resize, { once: true });
    requestAnimationFrame(tick);
  }

  function renderLists(){
    leftList.innerHTML = "";
    rightList.innerHTML = "";

    questions.forEach((q, idx) => {
      const el = document.createElement("div");
      el.className = "item";
      el.tabIndex = 0;
      el.dataset.qid = q.id;
      el.innerHTML = `
        <div class="textBlock">
          <div class="small">Q${idx+1}</div>
          <div class="main">${escapeHtml(q.text)}</div>
        </div>
        <div style="display:flex; align-items:center; gap:8px;">
          <span class="badge" data-badge-q="${q.id}"></span>
          <div class="dot" data-dot-for="${q.id}"></div>
        </div>
      `;
      el.addEventListener("click", () => onSelectQuestion(q.id, el));
      el.addEventListener("keydown", (e) => { if(e.key === "Enter") onSelectQuestion(q.id, el); });
      leftList.appendChild(el);
    });

    shuffle(answers).forEach((a, idx) => {
      const el = document.createElement("div");
      el.className = "item";
      el.tabIndex = 0;
      el.dataset.aid = a.id;
      el.innerHTML = `
        <div class="dot" data-dot-for="${a.id}"></div>
        <div class="textBlock">
          <div class="small">A${idx+1}</div>
          <div class="main">${escapeHtml(a.text)}</div>
        </div>
      `;
      el.addEventListener("click", () => onSelectAnswer(a.id, el));
      el.addEventListener("keydown", (e) => { if(e.key === "Enter") onSelectAnswer(a.id, el); });
      rightList.appendChild(el);
    });
  }

  function onSelectQuestion(qId, el){
    if(state.graded) return;

    if(state.pairByQ[qId]){
      const prevA = state.pairByQ[qId];
      delete state.pairByQ[qId];
      delete state.pairByA[prevA];
      clearSelections();
      rerenderAll();
      showToast("info", "ì—°ê²° í•´ì œ", `${labelOfQ(qId)} ì—°ê²°ì´ í•´ì œëì–´ìš”`);
      setStatus(`ì—°ê²° í•´ì œë¨: <b>${labelOfQ(qId)}</b> Â· ë‹¤ì‹œ ì„ íƒí•´ì„œ ì—°ê²°í•  ìˆ˜ ìˆì–´ìš”.`);
      return;
    }

    clearSelections();
    state.selectedQ = qId;
    el.classList.add("selected");
    showToast("info", "ì§ˆë¬¸ ì„ íƒ", `${labelOfQ(qId)} ì„ íƒë¨ Â· ì˜¤ë¥¸ìª½ì—ì„œ ë‹µì„ ì„ íƒí•˜ì„¸ìš”`);
    setStatus(`ì„ íƒë¨: <b>${labelOfQ(qId)}</b><br/>ì˜¤ë¥¸ìª½ì—ì„œ ë‹µë³€ì„ ì„ íƒí•´ ì—°ê²°í•˜ì„¸ìš”.`);
  }

  function onSelectAnswer(aId){
    if(state.graded) return;

    if(!state.selectedQ){
      showToast("bad", "ìˆœì„œ í™•ì¸", "ë¨¼ì € ì™¼ìª½ ì§ˆë¬¸ì„ ì„ íƒí•´ ì£¼ì„¸ìš”");
      setStatus(`ë¨¼ì € ì™¼ìª½ ì§ˆë¬¸ì„ ì„ íƒí•˜ì„¸ìš”.`);
      return;
    }

    if(state.pairByA[aId]){
      showToast("bad", "ì¤‘ë³µ ì—°ê²° ë¶ˆê°€", "ì´ ë‹µë³€ì€ ì´ë¯¸ ë‹¤ë¥¸ ì§ˆë¬¸ê³¼ ì—°ê²°ë˜ì–´ ìˆì–´ìš”");
      setStatus(`ì´ ë‹µë³€ì€ ì´ë¯¸ ë‹¤ë¥¸ ì§ˆë¬¸ê³¼ ì—°ê²°ë˜ì–´ ìˆì–´ìš”. (ì¤‘ë³µ ì—°ê²° ë¶ˆê°€)`);
      return;
    }

    const qId = state.selectedQ;
    state.pairByQ[qId] = aId;
    state.pairByA[aId] = qId;

    clearSelections();
    rerenderAll();

    showToast("good", "ì—°ê²° ì™„ë£Œ", `${labelOfQ(qId)} â†’ ${labelOfA(aId)}`);
    setStatus(`ì—°ê²° ì™„ë£Œ âœ…<br/><b>${labelOfQ(qId)}</b> â†’ <b>${escapeHtml(labelOfA(aId))}</b>`);

    if(Object.keys(state.pairByQ).length === questions.length){
      showToast("info", "ì¤€ë¹„ ì™„ë£Œ", "ëª¨ë‘ ì—°ê²°í–ˆì–´ìš” Â· ì´ì œ ì±„ì í•  ìˆ˜ ìˆì–´ìš”");
      setStatus(`ëª¨ë‘ ì—°ê²°í–ˆì–´ìš”! ì´ì œ <b>ì±„ì </b>ì„ ëˆŒëŸ¬ ì ìˆ˜ë¥¼ í™•ì¸í•˜ì„¸ìš”.`);
    }
  }

  function grade(){
    if(Object.keys(state.pairByQ).length !== questions.length) return;

    let correctCount = 0;
    const wrongs = [];

    for(const q of questions){
      const chosen = state.pairByQ[q.id];
      const isCorrect = (chosen === correct[q.id]);
      if(isCorrect) correctCount++;
      else {
        wrongs.push({
          qText: q.text,
          chosen: labelOfA(chosen),
          answer: labelOfA(correct[q.id])
        });
      }

      const badge = document.querySelector(`[data-badge-q="${q.id}"]`);
      if(badge){
        badge.style.display = "inline-flex";
        badge.className = "badge " + (isCorrect ? "good" : "bad");
        badge.textContent = isCorrect ? "ì •ë‹µ" : "ì˜¤ë‹µ";
      }
    }

    state.graded = true;
    state.lastScore = correctCount;
    scoreEl.textContent = `${correctCount}/${questions.length}`;
    btnShowAnswers.disabled = false;

    drawLines();
    const submitBlock = renderSubmitBlock(correctCount);

    if(wrongs.length === 0){
      showToast("good", "ì „ë¶€ ì •ë‹µ!", `ì ìˆ˜ ${correctCount}/${questions.length}`);
      setStatus(
        `ğŸ‰ <b>ì „ë¶€ ì •ë‹µ!</b> ì ìˆ˜: <b>${correctCount}/${questions.length}</b><br/>
         ì‹œìŠ¤í…œ ì´í•´ë„ê°€ ì˜ ë°˜ì˜ë˜ì—ˆì–´ìš” ğŸ‘<br/>
         ì•„ë˜ ë²„íŠ¼ì„ í†µí•´ ì™„ë£Œ ë©”ì¼ì„ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.` + submitBlock
      );
      launchConfetti(2400);
    } else {
      showToast("bad", "ì±„ì  ì™„ë£Œ", `ì ìˆ˜ ${correctCount}/${questions.length}`);
      const list = wrongs.map(w =>
        `â€¢ ${escapeHtml(w.qText)}<br/>
         &nbsp;&nbsp;ë‚´ ë‹µ: <b>${escapeHtml(w.chosen)}</b> / ì •ë‹µ: <b>${escapeHtml(w.answer)}</b>`
      ).join("<br/><br/>");

      setStatus(
        `ì±„ì  ì™„ë£Œ. ì ìˆ˜: <b>${correctCount}/${questions.length}</b><br/><br/>
         ì˜¤ë‹µ:<br/>${list}<br/><br/>
         ì´ë²ˆ ê²°ê³¼ëŠ” í•™ìŠµ í™•ì¸ìš©ì…ë‹ˆë‹¤.<br/>
         í•„ìš”í•˜ë‹¤ë©´ ë‹¤ì‹œ í’€ì–´ë³´ê³  ì œì¶œí•´ë„ ê´œì°®ì•„ìš” ğŸ™‚` + submitBlock
      );
    }
  }

  function showAnswers(){
    if(!state.graded) return;
    const lines = questions.map((q, i) => {
      const aId = correct[q.id];
      const aText = answers.find(a=>a.id===aId)?.text ?? aId;
      return `â€¢ Q${i+1}: <b>${escapeHtml(aText)}</b>`;
    }).join("<br/>");
    showToast("info", "ì •ë‹µ ë³´ê¸°", "ì „ì²´ ì •ë‹µì„ í‘œì‹œí–ˆì–´ìš”");
    setStatus(`<b>ì •ë‹µ ë¦¬ìŠ¤íŠ¸</b><br/>${lines}<br/><br/>ë¦¬ì…‹í•˜ë©´ ë‹¤ì‹œ í’€ ìˆ˜ ìˆì–´ìš”.`);
  }

  function reset(){
    state.selectedQ = null;
    state.pairByQ = {};
    state.pairByA = {};
    state.graded = false;
    state.lastScore = null;
    state.startedAt = Date.now();
    scoreEl.textContent = "-";

    document.querySelectorAll("[data-badge-q]").forEach(b => {
      b.style.display = "none";
      b.className = "badge";
      b.textContent = "";
    });

    btnShowAnswers.disabled = true;
    clearSelections();
    rerenderAll();
    showToast("info", "ë¦¬ì…‹", "ë‹¤ì‹œ í’€ ìˆ˜ ìˆì–´ìš”");
    setStatus("ë¦¬ì…‹ ì™„ë£Œ. ì™¼ìª½ ì§ˆë¬¸ì„ ì„ íƒí•´ ì‹œì‘í•˜ì„¸ìš”.");
  }

  btnGrade.addEventListener("click", grade);
  btnReset.addEventListener("click", reset);
  btnShowAnswers.addEventListener("click", showAnswers);

  window.addEventListener("resize", () => drawLines());

  window.addEventListener("keydown", (e) => {
    if(e.key === "Escape") {
      clearSelections();
      showToast("info", "ì„ íƒ í•´ì œ", "ì§ˆë¬¸ ì„ íƒì´ í•´ì œëì–´ìš”");
      setStatus("ì„ íƒ í•´ì œë¨. ì™¼ìª½ ì§ˆë¬¸ì„ ë‹¤ì‹œ ì„ íƒí•˜ì„¸ìš”.");
    }
  });

  renderLists();
  rerenderAll();
})();
</script>
</body>
</html>
